name: build

on:
  push:
    branches:
      - master
      - develop
  pull_request:
    branches:
      - master
      - develop
  release:
    types:
      - published

jobs:
  build_adcirc:
    name: Build NEMS + ADCIRC
    runs-on: ubuntu-latest
    container:
      image: zcobell/adcirc_20200513
    steps:
      - name: checkout repository
        uses: actions/checkout@v3
        with:
          submodules: recursive
          lfs: false
          # NOTE: this token is attached to my (@zacharyburnettNOAA) account because I have permission to clone the `adcirc-cg` repo which is private; perhaps in the future we can use the token from a dummy account, and / or an SSH key? The token is currently stored in the repository Secrets at https://github.com/noaa-ocs-modeling/ADC-WW3-NWM-NEMS/settings/secrets/actions
          token: ${{ secrets.PULL_TOKEN }}
      - name: build ESMF
        # TODO: build ESMF here and export `ESMFMKFILE`
        run: |
          echo build ESMF here
      - name: run build script
        run: sh ./build.sh --plat linux --component ADCIRC --compiler intel
        shell: bash
      - name: save built binaries
        uses: actions/upload-artifact@v2
        with:
          name: build
          path: |
            ./ALLBIN_INSTALL/NEMS-adcirc.x
            ./ALLBIN_INSTALL/adcprep
        
